= Plug

== Building

==== Linux and Mac

For Unix-based operating systems, you should run the following commands:

[source, shell]
----
curl https://sh.rustup.rs -sSf | sh

rustup update nightly
rustup target add wasm32-unknown-unknown --toolchain nightly
rustup update stable
cargo install --git https://github.com/alexcrichton/wasm-gc
----

You will also need to install the following packages:

 - Linux:
[source, shell]
sudo apt install cmake pkg-config libssl-dev git clang libclang-dev

 - Mac:
[source, shell]
brew install cmake pkg-config openssl git llvm

To finish installation of Plug, jump down to <<shared-steps,shared steps>>.

==== Windows

If you are trying to set up Plug on Windows, you should do the following:

1. First, you will need to download and install "Build Tools for Visual Studio:"

    * You can get it at this link: https://aka.ms/buildtools
    * Run the installation file: `vs_buildtools.exe`
    * Please ensure the Windows 10 SDK component is included when installing the Visual C++ Build Tools.
    * image:https://i.imgur.com/zayVLmu.png[image]
    * Restart your computer.

2. Next, you need to install Rust:

    * Detailed instructions are provided by the https://doc.rust-lang.org/book/ch01-01-installation.html#installing-rustup-on-windows[Rust Book].
        * Download from: https://www.rust-lang.org/tools/install
        * Run the installation file: `rustup-init.exe`
        > Note that it should not prompt you to install vs_buildtools since you did it in step 1.
        * Choose "Default Installation."
        * To get started, you need Cargo's bin directory (%USERPROFILE%\.cargo\bin) in your PATH environment variable. Future applications will automatically have the correct environment, but you may need to restart your current shell.

3. Then, you will need to run some commands in CMD to set up your Wasm Build Environment:

	rustup update nightly
	rustup update stable
	rustup target add wasm32-unknown-unknown --toolchain nightly

4. Next, you install wasm-gc, which is used to slim down Wasm files:

	cargo install --git https://github.com/alexcrichton/wasm-gc --force

5. Then, you need to install LLVM: https://releases.llvm.org/download.html

6. Next, you need to install OpenSSL, which we will do with `vcpkg`:

	mkdir \Tools
	cd \Tools
	git clone https://github.com/Microsoft/vcpkg.git
	cd vcpkg
	.\bootstrap-vcpkg.bat
	.\vcpkg.exe install openssl:x64-windows-static

7. After, you need to add OpenSSL to your System Variables:

	$env:OPENSSL_DIR = 'C:\Tools\vcpkg\installed\x64-windows-static'
	$env:OPENSSL_STATIC = 'Yes'
	[System.Environment]::SetEnvironmentVariable('OPENSSL_DIR', $env:OPENSSL_DIR, [System.EnvironmentVariableTarget]::User)
	[System.Environment]::SetEnvironmentVariable('OPENSSL_STATIC', $env:OPENSSL_STATIC, [System.EnvironmentVariableTarget]::User)

8. Finally, you need to install `cmake`: https://cmake.org/download/

==== Shared Steps

Then, grab the Plug source code:

[source, shell]
----
git clone git@github.com:cennznet/plug-blockchain.git
cd plug-blockchain
----

Then build the code:

[source, shell]
----
cargo build                 # Builds all native code
----

You can run all the tests if you like:

[source, shell]
cargo test --all

Or just run the tests of a specific package (i.e. `cargo test -p srml-assets`)

You can start a development chain with:

[source, shell]
cargo run \-- --dev

Detailed logs may be shown by running the node with the following environment variables set: `RUST_LOG=debug RUST_BACKTRACE=1 cargo run \-- --dev`.

If you want to see the multi-node consensus algorithm in action locally, then you can create a local testnet with two validator nodes for Alice and Bob, who are the initial authorities of the genesis chain specification that have been endowed with a testnet DOTs. We'll give each node a name and expose them so they are listed on link:https://telemetry.polkadot.io/#/Local%20Testnet[Telemetry] . You'll need two terminals windows open.

We'll start Alice's plug node first on default TCP port 30333 with her chain database stored locally at `/tmp/alice`. The Bootnode ID of her node is `QmQZ8TjTqeDj3ciwr93EJ95hxfDsb9pEYDizUAbWpigtQN`, which is generated from the `--node-key` value that we specify below:

[source, shell]
cargo run --release \-- \
  --base-path /tmp/alice \
  --chain=local \
  --alice \
  --node-key 0000000000000000000000000000000000000000000000000000000000000001 \
  --telemetry-url ws://telemetry.polkadot.io:1024 \
  --validator

In the second terminal, we'll run the following to start Bob's plug node on a different TCP port of 30334, and with his chain database stored locally at `/tmp/bob`. We'll specify a value for the `--bootnodes` option that will connect his node to Alice's Bootnode ID on TCP port 30333:

[source, shell]
cargo run --release \-- \
  --base-path /tmp/bob \
  --bootnodes /ip4/127.0.0.1/tcp/30333/p2p/QmRpheLN4JWdAnY7HGJfWFNbfkQCb6tFf4vvA6hgjMZKrR \
  --chain=local \
  --bob \
  --port 30334 \
  --telemetry-url ws://telemetry.polkadot.io:1024 \
  --validator

<<<<<<< HEAD
Additional Plug CLI usage options are available and may be shown by running `cargo run \-- --help`.
=======
Additional Substrate CLI usage options are available and may be shown by running `cargo run \-- --help`.

=== WASM binaries

The WASM binaries are built during the normal `cargo build` process. To control the WASM binary building,
we support multiple environment variables:

* `SKIP_WASM_BUILD` - Skips building any WASM binary. This is useful when only native should be recompiled.
* `BUILD_DUMMY_WASM_BINARY` - Builds dummy WASM binaries. These dummy binaries are empty and useful
                              for `cargo check` runs.
* `WASM_BUILD_TYPE` - Sets the build type for building WASM binaries. Supported values are `release` or `debug`.
                      By default the build type is equal to the build type used by the main build.
* `TRIGGER_WASM_BUILD` - Can be set to trigger a WASM build. On subsequent calls the value of the variable
                         needs to change. As WASM builder instructs `cargo` to watch for file changes
                         this environment variable should only be required in certain circumstances.

Each project can be skipped individually by using the environment variable `SKIP_PROJECT_NAME_WASM_BUILD`.
Where `PROJECT_NAME` needs to be replaced by the name of the cargo project, e.g. `node-runtime` will
be `NODE_RUNTIME`.

[[flaming-fir]]
=== Joining the Flaming Fir Testnet

Flaming Fir is the new testnet for Substrate master (2.0) to test the latest development features. Please note that master is not compatible with the BBQ Birch, Charred Cherry, Dried Danta or Emberic Elm testnets. Ensure you have the dependencies listed above before compiling.

Since Flaming Fir is targeting the master branch we make absolutely no guarantees of stability and/or persistence of the network. We might reset the chain at any time if it is necessary to deploy new changes. Currently, the validators are running with a client built from `d013bd900`, if you build from this commit you should be able to successfully sync, later commits may not work as new breaking changes may be introduced in master.

Latest known working version: `d013bd900`

[source, shell]
----
git clone https://github.com/paritytech/substrate.git
cd substrate
git checkout -b flaming-fir d013bd900
----

You can run the tests if you like:

[source, shell]
cargo test --all

Start your node:

[source, shell]
cargo run --release \--

To see a list of command line options, enter:

[source, shell]
cargo run --release \-- --help

For example, you can choose a custom node name:

[source, shell]
cargo run --release \-- --name my_custom_name

If you are successful, you will see your node syncing at https://telemetry.polkadot.io/#/Flaming%20Fir

=== Joining the Emberic Elm Testnet

Emberic Elm is the testnet for Substrate 1.0. Please note that 1.0 is not compatible with the BBQ Birch, Charred Cherry, Dried Danta or Flaming Fir testnets.
In order to join the Emberic Elm testnet you should build from the `v1.0` branch. Ensure you have the dependencies listed above before compiling.

[source, shell]
----
git clone https://github.com/paritytech/substrate.git
cd substrate
git checkout -b v1.0 origin/v1.0
----

You can then follow the same steps for building and running as described above in <<flaming-fir>>.

== Key management

Keys in Substrate are stored in the keystore in the file system. To store keys into this keystore,
you need to use one of the two provided RPC calls. If your keys are encrypted or should be encrypted
by the keystore, you need to provide the key using one of the cli arguments `--password`,
`--password-interactive` or `--password-filename`.

=== Recommended RPC call

For most users who want to run a validator node, the `author_rotateKeys` RPC call is sufficient.
The RPC call will generate `N` Session keys for you and return their public keys. `N` is the number
of session keys configured in the runtime. The output of the RPC call can be used as input for the
`session::set_keys` transaction.

```
curl -H 'Content-Type: application/json' --data '{ "jsonrpc":"2.0", "method":"author_rotateKeys", "id":1 }' localhost:9933
```

=== Advanced RPC call

If the Session keys need to match a fixed seed, they can be set individually key by key. The RPC call
expects the key seed and the key type. The key types supported by default in Substrate are listed
https://github.com/paritytech/substrate/blob/master/core/primitives/src/crypto.rs#L767[here], but the
user can declare any key type.

```
curl -H 'Content-Type: application/json' --data '{ "jsonrpc":"2.0", "method":"author_insertKey", "params":["KEY_TYPE", "SEED"],"id":1 }' localhost:9933
```

`KEY_TYPE` - needs to be replaced with the 4-character key type identifier.
`SEEED` - is the seed of the key.

== Documentation

=== Viewing documentation for Substrate packages

You can generate documentation for a Substrate Rust package and have it automatically open in your web browser using https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html#using-rustdoc-with-cargo[rustdoc with Cargo],
(of the The Rustdoc Book), by running the the following command:

```
cargo doc --package <spec> --open
```

Replacing `<spec>` with one of the following (i.e. `cargo doc --package substrate --open`):

* All Substrate Packages
[source, shell]
substrate
* Substrate Core
[source, shell]
substrate, substrate-cli, substrate-client, substrate-client-db,
substrate-consensus-common, substrate-consensus-rhd,
substrate-executor, substrate-finality-grandpa, substrate-keyring, substrate-keystore, substrate-network,
substrate-network-libp2p, substrate-primitives, substrate-rpc, substrate-rpc-servers,
substrate-serializer, substrate-service, substrate-service-test, substrate-state-db,
substrate-state-machine, substrate-telemetry, substrate-test-client,
substrate-test-runtime, substrate-transaction-graph, substrate-transaction-pool,
substrate-trie
* Substrate Runtime
[source, shell]
sr-api, sr-io, sr-primitives, sr-sandbox, sr-std, sr-version
* Substrate Runtime Module Library (SRML)
[source, shell]
srml-assets, srml-balances, srml-consensus, srml-contracts, srml-council, srml-democracy, srml-example,
srml-executive, srml-metadata, srml-session, srml-staking, srml-support, srml-system, srml-timestamp,
srml-treasury
* Node
[source, shell]
node-cli, node-consensus, node-executor, node-network, node-primitives, node-runtime
* Subkey
[source, shell]
subkey

=== Contributing to documentation for Substrate packages

https://doc.rust-lang.org/1.9.0/book/documentation.html[Document source code] for Substrate packages by annotating the source code with documentation comments.

Example (generic):
```markdown
/// Summary
///
/// Description
///
/// # Panics
///
/// # Errors
///
/// # Safety
///
/// # Examples
///
/// Summary of Example 1
///
/// ```rust
/// // insert example 1 code here
/// ```
///
```

* Important notes:
** Documentation comments must use annotations with a triple slash `///`
** Modules are documented using `//!`
```
//! Summary (of module)
//!
//! Description (of module)
```
* Special section header is indicated with a hash `#`.
** `Panics` section requires an explanation if the function triggers a panic
** `Errors` section is for describing conditions under which a function of method returns `Err(E)` if it returns a `Result<T, E>`
** `Safety` section requires an explanation if the function is `unsafe`
** `Examples` section includes examples of using the function or method
* Code block annotations for examples are included between triple graves, as shown above.
Instead of including the programming language to use for syntax highlighting as the annotation
after the triple graves, alternative annotations include the `ignore`, `text`, `should_panic`, or `no_run`.
* Summary sentence is a short high level single sentence of its functionality
* Description paragraph is for details additional to the summary sentence
* Missing documentation annotations may be used to identify where to generate warnings with `#![warn(missing_docs)]`
or errors `#![deny(missing_docs)]`
* Hide documentation for items with `#[doc(hidden)]`

=== Contributing to documentation (tests, extended examples, macros) for Substrate packages

The code block annotations in the `# Example` section may be used as https://doc.rust-lang.org/1.9.0/book/documentation.html#documentation-as-tests[documentation as tests and for extended examples].

* Important notes:
** Rustdoc will automatically add a `main()` wrapper around the code block to test it
** https://doc.rust-lang.org/1.9.0/book/documentation.html#documenting-macros[Documenting macros].
** Documentation as tests examples are included when running `cargo test`

== Contributing

=== Contributing Guidelines

include::CONTRIBUTING.adoc[]

=== Contributor Code of Conduct

include::CODE_OF_CONDUCT.adoc[]

== License

https://github.com/paritytech/substrate/blob/master/LICENSE[LICENSE]
>>>>>>> substrate/master
